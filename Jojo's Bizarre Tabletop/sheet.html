<html>
    <div class = "charinfo">
        <div class = "logo">
            <img src = "https://vignette.wikia.nocookie.net/jjba/images/d/d5/Jojo's_Bizarre_Adventure_(Classic_English_Logo_Vector).png">
        </div>
        <div class = "user section">
            <!--Character name-->
            <label>
                Character Name
                <input name = "attr_character_name">
            </label>

            <label>
                Character Points
                <input name = "attr_cp" type = "number" value = "0">
            </label>

            <div class = "divider"></div>

            <label>
                Character Types
                <fieldset class = "repeating_chartypes">
                    <select name = "attr_chartype">
                        <option value = ""></option>
                        <option value = "Robotic">Robotic</option>
                        <option value = "Hype Man">Hype Man</option>
                        <option value = "Hamon">Hamon</option>
                        <option value = "Vampire">Vampire</option>
                        <option value = "Spin">Spin</option>
                        <option value = "No Stand">No Stand</option>
                    </select>
                    <div class = "ranks">
                        Rank 1 <input type = "radio" name = "attr_typerank">
                        Rank 2 <input type = "radio" name = "attr_typerank">
                        Rank 3 <input type = "radio" name = "attr_typerank">
                    </div>
                </fieldset>
            </label>

            <div class = "divider"></div>

            <!-- User Stats -->
            <table>
                <tr class = "statlabel">
                    <td>Brains</td>
                    <td>Brawns</td>
                    <td>Bravery</td>
                </tr>
                <tr>
                    <td>
                        <input name = "attr_brains" type = "number" value = "0">
                    </td>
                    <td>
                        <input name = "attr_brawns" type = "number" value = "0">
                    </td>
                    <td>
                        <input name = "attr_bravery" type = "number" value = "0">
                    </td>
                </tr>
                <tr class = "statlabel">
                    <td>Real Health</td>
                    <td>Resolve Health</td>
                    <td>Bizarre Points</td>
                </tr>
                <tr>
                    <td>
                        <input name = "attr_health" type = "number" value = "0">
                    </td>
                    <td>
                        <input name = "attr_resolve" type = "number" value = "0">
                    </td>
                    <td>
                        <input name = "attr_bp" type = "number" value = "0">
                    </td>
                </tr>
            </table>
        </div>

        <input name = "attr_hasstand" type = "checkbox" class = "has_stand hidden" checked = "checked" value = "1">

        <!--Stand wrapper - hides when the "No Stand" option is selected -->
        <div class = "stand">
            <!-- Stand Stats and info-->
            <div class = "standinfo section">
                <label>
                    Stand Name <input name = "attr_stand_name">
                </label>
                <!--Add tooltips of each stand type description using the Title parameter-->
                <label>
                    Stand Types
                    <fieldset class = "repeating_standtypes">
                        <select name = "attr_standtype">
                            <option value = ""></option>
                            <option disabled>DISTANCE</option>
                            <option value = "Close Distance Power">Close Distance Power</option>
                            <option value = "Long Distance Manipulation">Long Distance Manipulation</option>
                            <option value = "Far Distance Autopilot">Far Distance Autopilot</option>
                            <option disabled>FORM</option>
                            <option value = "Substance Assimilation">Substance Assimilation</option>
                            <option value = "Integrated">Integrated</option>
                            <option value = "Wearable">Wearable</option>
                            <option value = "Colony">Colony</option>
                            <option disabled>MISC.</option>
                            <option value = "ACT Stand">ACT Stand</option>
                            <option value = "Universal Range">Universal Range</option>
                        </select>
                    </fieldset>
                </label>

                <div class = "divider"></div>

                <!--Stats-->
                <table>
                    <tr class = "statlabel">
                        <td>Stat</td>
                        <td>Rank</td>
                        <td>Dice</td>
                        <td>Modifier</td>
                    </tr>
                    <tr class = "power">
                        <td>Power</td>
                        <td>
                            <select name = "attr_power_val">
                                <option>A</option>
                                <option>B</option>
                                <option selected>C</option>
                                <option>D</option>
                                <option>E</option>
                            </select>
                        </td>
                        <td><span name = "attr_power_dice" value = "2d6">2d6</span></td>
                        <td><span name = "attr_power_mod" value = "1">+1</span></td>
                    </tr>
                    <tr class = "speed">
                        <td>Speed</td>
                        <td>
                            <select name = "attr_speed_val">
                                <option>A</option>
                                <option>B</option>
                                <option selected>C</option>
                                <option>D</option>
                                <option>E</option>
                            </select>
                        </td>
                        <td><span name = "attr_speed_dice" value = "2d6">2d6</span></td>
                        <td><span name = "attr_speed_mod" value = "1">+1</span></td>
                    </tr>
                    <tr class = "range">
                        <td>Range</td>
                        <td>
                            <select name = "attr_range_val">
                                <option>A</option>
                                <option>B</option>
                                <option selected>C</option>
                                <option>D</option>
                                <option>E</option>
                            </select>
                        </td>
                        <td><span name = "attr_range_dice" value = "2d6">2d6</span></td>
                        <td><span name = "attr_range_mod" value = "1">+1</span></td>
                    </tr>
                    <tr class = "durability">
                        <td>Durability</td>
                        <td>
                            <select name = "attr_durability_val">
                                <option>A</option>
                                <option>B</option>
                                <option selected>C</option>
                                <option>D</option>
                                <option>E</option>
                            </select>
                        </td>
                        <td><span name = "attr_durability_dice" value = "2d6">2d6</span></td>
                        <td><span name = "attr_durability_mod" value = "1">+1</span></td>
                    </tr>
                    <tr class = "precision">
                        <td>Precision</td>
                        <td>
                            <select name = "attr_precision_val">
                                <option>A</option>
                                <option>B</option>
                                <option selected>C</option>
                                <option>D</option>
                                <option>E</option>
                            </select>
                        </td>
                        <td><span name = "attr_precision_dice" value = "2d6">2d6</span></td>
                        <td><span name = "attr_precision_mod" value = "1">+1</span></td>
                    </tr>
                    <tr class = "learning">
                        <td>Learning</td>
                        <td>
                            <select name = "attr_learning_val">
                                <option>A</option>
                                <option>B</option>
                                <option selected>C</option>
                                <option>D</option>
                                <option>E</option>
                            </select>
                        </td>
                        <td><span name = "attr_learning_dice" value = "2d6">2d6</span></td>
                        <td><span name = "attr_learning_mod" value = "1">+1</span></td>
                    </tr>
                </table>

                <!--Critical weaknesses-->
                <div class = "statlabel" style = "width: 100%; text-align: center; padding:1vh;">Critical Weaknesses</div>
                <!--Power-->
                <input name = "attr_power_cw" class = "hidden" type = "checkbox" checked = "" value = "1">
                <table class = "power_cw cw">
                    <tr>
                        <td>Power</td>
                        <td><textarea name = "attr_power_cw_input"></textarea></td>
                    </tr>
                </table>
                <!--Speed-->
                <input name = "attr_speed_cw" class = "hidden" type = "checkbox" checked = "" value = "1">
                <table class = "speed_cw cw">
                    <tr>
                        <td>Speed</td>
                        <td><textarea name = "attr_speed_cw_input"></textarea></td>
                    </tr>
                </table>
                <!--Range-->
                <input name = "attr_range_cw" class = "hidden" type = "checkbox" checked = "" value = "1">
                <table class = "range_cw cw">
                    <tr>
                        <td>Range</td>
                        <td><textarea name = "attr_range_cw_input"></textarea></td>
                    </tr>
                </table>
                <!--Durability-->
                <input name = "attr_durability_cw" class = "hidden" type = "checkbox" checked = "" value = "1">
                <table class = "durability_cw cw">
                    <tr>
                        <td>Durability</td>
                        <td><textarea name = "attr_durability_cw_input"></textarea></td>
                    </tr>
                </table>
                <!--Precision-->
                <input name = "attr_precision_cw" class = "hidden" type = "checkbox" checked = "" value = "1">
                <table class = "precision_cw cw">
                    <tr>
                        <td>Precision</td>
                        <td><textarea name = "attr_precision_cw_input"></textarea></td>
                    </tr>
                </table>
                <!--Learning-->
                <input name = "attr_learning_cw" class = "hidden" type = "checkbox" checked = "" value = "1">
                <table class = "learning_cw cw">
                    <tr>
                        <td>Learning</td>
                        <td><textarea name = "attr_learning_cw_input"></textarea></td>
                    </tr>
                </table>

            </div>

        </div>

        <!--The section of the ~forbidden~ inputs. This should always go last. -->
        <div class = "hidden">
            <input name = "attr_power_dice" value = "2d6">
            <input name = "attr_power_mod" value = "1">
            <input name = "attr_speed_dice" value = "2d6">
            <input name = "attr_speed_mod" value = "1">
            <input name = "attr_range_dice" value = "2d6">
            <input name = "attr_range_mod" value = "1">
            <input name = "attr_durability_dice" value = "2d6">
            <input name = "attr_durability_mod" value = "1">
            <input name = "attr_precision_dice" value = "2d6">
            <input name = "attr_precision_mod" value = "1">
            <input name = "attr_learning_dice" value = "2d6">
            <input name = "attr_learning_mod" value = "1">
            <!--Stand checkbox-->

        </div>
    </div>

    <!-- It's time for scripts -->
    <script type="text/worker">
      //here we go
      var getSectionIDsOrdered = function (sectionName, callback) {
        'use strict';
        getAttrs([`_reporder_${sectionName}`], function (v) {
          getSectionIDs(sectionName, function (idArray) {
            let reporderArray = v[`_reporder_${sectionName}`] ? v[`_reporder_${sectionName}`].toLowerCase().split(',') : [],
              ids = [...new Set(reporderArray.filter(x => idArray.includes(x)).concat(idArray))];
            callback(ids);
          });
        });
      };
      //hides stand sections when box isn't checked
      on("change:repeating_chartypes:chartype", function(eventInfo) {
        getAttrs(["hasstand"], function(v) {
          console.log(v);
          log(eventInfo.newValue);
          log(eventInfo.newValue = "No Stand")
          if (eventInfo.newValue == "No Stand")
          setAttrs({
              hasstand: 0
          });
          console.log(v.hasstand)
        });
      });
      on("remove:repeating_chartypes", function(eventInfo) {
          console.log(eventInfo);
          id = eventInfo.sourceAttribute;
          obj = eventInfo.removedInfo;
          if (obj[id + "_chartype"] == "No Stand"){
              getAttrs(["hasstand"], function(v) {
                  console.log(v);
                  setAttrs({
                      hasstand: 1
                  });
                  console.log(v.hasstand)
              });
          }
      });

      //stat dice and mods
      let rankvals = ["E","D","C","B","A"]
      let dicevals = ["1d6","2d6 keep 1","2d6","3d6 keep 2","3d6"];
      let modvals = ["-5","-3","+1","+3","+5"];

      on("change:power_val", function(eventInfo) {
          getAttrs(["power_val","power_dice","power_mod"], function(v) {
              let value = v.power_val;
              let index = rankvals.indexOf(value);
              setAttrs({
                  power_dice: dicevals[index],
                  power_mod: modvals[index]
              });
              if (value == "E"){
                  console.log("Power is E rank!");
                  setAttrs({
                      power_cw: 1
                  });
              } else {
                  setAttrs({
                      cw: 0,
                      power_cw: 0
                  });
              }

          });
      });
      on("change:speed_val", function(eventInfo) {
          getAttrs(["speed_val","speed_dice","speed_mod"], function(v) {
              let value = v.speed_val;
              let index = rankvals.indexOf(value);
              setAttrs({
                  speed_dice: dicevals[index],
                  speed_mod: modvals[index]
              });
              if (value == "E"){
                  setAttrs({
                      speed_cw: 1
                  });
              } else {
                  setAttrs({
                      cw: 0,
                      speed_cw: 0
                  });
              }
          });
      });
      on("change:range_val", function(eventInfo) {
          getAttrs(["range_val","range_dice","range_mod"], function(v) {
              let value = v.range_val;
              let index = rankvals.indexOf(value);
              setAttrs({
                  range_dice: dicevals[index],
                  range_mod: modvals[index]
              });
              if (value == "E"){
                  setAttrs({
                      range_cw: 1
                  });
              } else {
                  setAttrs({
                      cw: 0,
                      range_cw: 0
                  });
              }
          });
      });
      on("change:durability_val", function(eventInfo) {
          getAttrs(["durability_val","durability_dice","durability_mod"], function(v) {
              let value = v.durability_val;
              let index = rankvals.indexOf(value);
              setAttrs({
                  durability_dice: dicevals[index],
                  durability_mod: modvals[index]
              });
              if (value == "E"){
                  setAttrs({
                      durability_cw: 1
                  });
              } else {
                  setAttrs({
                      cw: 0,
                      durability_cw: 0,
                  });
              }
          });
      });
      on("change:precision_val", function(eventInfo) {
          getAttrs(["precision_val","precision_dice","precision_mod"], function(v) {
              let value = v.precision_val;
              let index = rankvals.indexOf(value);
              setAttrs({
                  precision_dice: dicevals[index],
                  precision_mod: modvals[index]
              });
              if (value == "E"){
                  setAttrs({
                      precision_cw: 1
                  });
              } else {
                  setAttrs({
                      precision_cw: 0
                  });
              }
          });
      });
      on("change:learning_val", function(eventInfo) {
          getAttrs(["learning_val","learning_dice","learning_mod"], function(v) {
              let value = v.learning_val;
              let index = rankvals.indexOf(value);
              setAttrs({
                  learning_dice: dicevals[index],
                  learning_mod: modvals[index]
              });
              if (value == "E"){
                  setAttrs({
                      learning_cw: 1
                  });
              } else {
                  setAttrs({
                      learning_cw: 0
                  });
              }
          });
      });


    </script>

</html>
